@model IEnumerable<HospitalRiwi.Models.MedicalDate>

@{
    ViewData["Title"] = "Gestión de Citas";
}

<h1>@ViewData["Title"]</h1>

<div class="d-flex justify-content-between align-items-center mb-3">
    
    <div>
        <a asp-action="Create" class="btn btn-primary">Agendar Nueva Cita</a>
    </div>
</div>

<div class="card card-body bg-light mb-4">
    <form asp-action="Index" method="get">
        <div class="row align-items-end">
            <div class="col-md-5">
                <label for="patientId" class="form-label">Filtrar por Paciente</label>
                <select name="patientId" class="form-select" asp-items="ViewBag.PatientsList">
                    <option value="">-- Todos los Pacientes --</option>
                </select>
            </div>
            <div class="col-md-5">
                <label for="doctorId" class="form-label">Filtrar por Médico</label>
                <select name="doctorId" class="form-select" asp-items="ViewBag.DoctorsList">
                    <option value="">-- Todos los Médicos --</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-info w-100">Filtrar</button>
                <a asp-action="Index" class="btn btn-secondary w-100 mt-1">Limpiar</a>
            </div>
        </div>
    </form>
</div>

<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Paciente</th>
            <th>Médico</th>
            <th>Fecha y Hora</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model) {
            <tr>
                <td>@Html.DisplayFor(modelItem => item.Patient.Name)</td>
                <td>@Html.DisplayFor(modelItem => item.Doctor.Name)</td>
                <td>@Html.DisplayFor(modelItem => item.Appointment)</td>
                <td>@Html.DisplayFor(modelItem => item.Status)</td>
                <td>
                    @if (item.Status == "Scheduled")
                    {
                        <div class="d-flex">
                            <form asp-action="Attend" asp-route-id="@item.Id" method="post" class="me-1">
                                <button type="submit" class="btn btn-success btn-sm">Atendida</button>
                            </form>
                            <form asp-action="Cancel" asp-route-id="@item.Id" method="post">
                                <button type="submit" class="btn btn-danger btn-sm">Cancelar</button>
                            </form>
                        </div>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>